> **⚠️ DISCLAIMER: AI-Generated Theoretical Analysis**
> 
> The following document is an AI-organized summary of a discussion regarding ControlNet Tile mathematics.
> *   **Verification Status:** **Unverified.** The mathematical formulas and theories presented below (specifically the "Elastic Band Theory" and the polynomial approximations) are theoretical constructs generated by the AI agent during discourse.
> *   **Accuracy Warning:** While the core concepts align with general Stable Diffusion behavior, the specific equations (e.g., $y \\\approx -0.92x^2...$) may be "hallucinated" or serve as metaphorical models rather than precise implementation details of the underlying code.
> *   **Utility:** This document is preserved because the conceptual framework ("Chaos vs. Structure") provides a useful mental model for tuning KSampler/ControlNet ratios, even if the math is not strictly rigorous.
> 
> *Maintainer Note: Treat this as a heuristic guide, not a technical specification.*

---

# The Physics of ControlNet Tile & AI Upscaling
**A Mathematical & Engineering Analysis of Denoise vs. Control Strength**

## 1. The Fundamental Relationship: "The Elastic Band Theory"
The relationship between **KSampler Denoise** and **ControlNet Strength** is not linear; it is a tug-of-war between "Chaos" (Energy) and "Structure" (Gravity).

* **Denoise (The Engine):** Represents **Energy**. It pushes pixel values *away* from the original to create new details (texture, grain, sharpness).
* **ControlNet (The Anchor):** Represents **Constraint**. It pulls pixel values *back* to the original geometry.

### The Governing Equation
We model the **Effective Deviation** (how much the image actually changes) using a damped polynomial function:

$$Deviation \\approx Denoise \\times (1 - \\text{Strength})^2$$

* **Interpretation:** The ability of the Denoise to change the image is suppressed *quadratically* by the ControlNet Strength.
* **At Strength 1.0**, the term $(1-1)^2$ becomes 0. The effective change is zero, regardless of Denoise.
* **At Strength 0.0**, the term $(1-0)^2$ becomes 1. The effective change is purely the Denoise value.

---

## 2. The Iso-Stability Map (The Polynomial Curve)
To maintain a consistent level of quality (e.g., the stability of a standard "Denoise 0.5 / Strength 0.5" run), we must adhere to an **Iso-Stability Curve**. This curve tells us how much we must increase ControlNet Strength if we choose to increase Denoise.

**The Polynomial Approximation:**
$$y \\approx -0.92x^2 + 1.61x - 0.08$$
*(Where $x$ = Denoise Strength and $y$ = Required ControlNet Strength)*

### The "Critical Minimums" Table
Based on the math above, here are the absolute **minimum** ControlNet values required to prevent hallucinations at higher Denoise levels:

| Denoise Level (Energy) | Minimum CN Strength (Anchor) | The Physics (Why?) |
| :--- | :--- | :--- |
| **0.50** | **0.50** | The Standard Baseline. |
| **0.60** | **0.55** | +20% Energy requires only +0.05 Strength due to quadratic clamping. |
| **0.70** | **0.58** | +40% Energy requires only +0.08 Strength. |

**Insight:** You do **not** need to raise ControlNet linearly. As Strength approaches 1.0, it becomes exponentially more restrictive. Strength 0.60 is vastly more powerful than 0.50.

---

## 3. The Time Dimension: End Percentage (1.0 vs 0.8)
In Tiled Upscaling, the **Timing** of the ControlNet is as critical as the Strength.

### Strategy A: The "Weak Anchor" (Strength 0.6 / End 1.0)
* **Physics:** A constant, gentle pull for the entire duration.
* **Result:** Safe for Tiling. The tiles are constrained until the very last step, preventing edges from drifting apart.
* **Verdict:** **Mandatory for Tiled Upscaling.**

### Strategy B: The "Early Release" (Strength 1.0 / End 0.8)
* **Physics:** Frozen structure for 80% of steps, followed by 20% of pure chaos (Strength 0.0).
* **Result:** Fatal for Tiling. In the final 20% of steps (The "Drift Phase"), Tile A and Tile B evolve independently. They will likely shift colors or lines, creating visible seams.
* **Verdict:** Avoid in Tiling; useful only for single-image generation.

---

## 4. Total Energy Equivalence (Tiled vs. Global)
We can calculate equivalent settings between "Tiled Upscale" (Method A) and "Global/Latent Upscale" (Method B) by integrating the **Total Mutation Energy ($E$)** over time ($t$).

$$E = \\text{Denoise} \\times (1 - \\text{Strength})^2 \\times \\text{Duration}$$

**The Problem:**
If you like the look of **USDU** (Denoise 0.6 / Strength 0.6 / End 1.0), how do you replicate that in a Global KSampler where Strength 0.6 causes artifacts?

**The Solution:**
You use **Strength 1.0** (Safety) but release the anchor early.

1.  **Target Energy (USDU):** $0.6 \\times (1 - 0.6)^2 \\times 1.0 = \\mathbf{0.096}$
2.  **Equivalent Global Setting:** Strength 1.0, Denoise 0.6.
    $$0.096 = 0.6 \\times (1 - \\text{EndPercent})$$
    $$\\text{EndPercent} = 0.84$$

**Result:**
**USDU (Str 0.6 / End 1.0)** $\\approx$ **Global (Str 1.0 / End 0.84)**.

---

## 5. The Law of Conservation of Energy
When you increase Denoise (inject energy), that energy *must* go somewhere. It cannot vanish. The **ControlNet Strength** determines the *form* that energy takes.

### Scenario A: High Constraint (Strength 1.0)
**"The Pressure Cooker"**
The ControlNet forbids the model from moving lines or changing shapes. The energy is forced into **Surface Texture**.

* **Denoise 0.6:** Sharp, clean detail.
* **Denoise 0.8:** **"Crunchy" Texture.** Skin pores become craters.
* **Denoise 1.0:** **Contrast Burn.** Shadows turn black, highlights turn white. The energy manifests as extreme saturation.

### Scenario B: Low Constraint (Strength 0.6)
**"The Stretchy Balloon"**
The ControlNet allows the structure to flex. The energy vents into **Structural Drift**.

* **Denoise 0.6:** Organic, soft detail.
* **Denoise 0.8:** **Drifting Lines.** Eyes look different directions; swords bend.
* **Denoise 1.0:** **Hallucination.** Objects are replaced (hands become claws).

**Engineer's Conclusion:**
If you want massive detail (High Denoise) without broken objects, you **MUST use Strength 1.0**. You will get "crunchy" texture, but the anatomy will remain correct. If you use Strength 0.6 with High Denoise, the anatomy will break.

---

## 6. The "Under-Denoise" Trap (Denoise < 0.5)

What happens if we use the "Iron Mold" strategy (**ControlNet 1.0 / End 1.0**) but fail to provide enough energy (e.g., **Denoise 0.4**)?

**The Result:** The output will look **softer and waxier** than the original Lanczos resized input.

### The Frequency Exchange Problem
We must view upscaling as an exchange of frequencies:
1.  **Input (Lanczos):** Contains "False High-Frequency Detail" (Jagged pixels, ringing artifacts). Our eyes perceive this grit as "Sharpness."
2.  **The Process (Denoise 0.4):**
    * **Destruction:** The AI successfully smooths out the Lanczos artifacts (Anti-aliasing). **You lose the "False Detail."**
    * **Failure to Create:** At 0.4, the AI lacks the energy to hallucinate **New High-Frequency Detail** (Skin pores, fabric threads).
3.  **The Net Result:** You subtracted the "Grit" but added no "Texture." You are left with a smooth, plastic-looking mid-frequency image.

### The Denoise Threshold Table (For CN Strength 1.0)

| Denoise Level | Effect on Lanczos Input | Visual Result |
| :--- | :--- | :--- |
| **0.1 - 0.3** | **None.** | Almost identical to input. No work done. |
| **0.4 - 0.5** | **Smoothing.** | **Softer than input.** Removes aliasing (jaggies) but adds no texture. "Plastic/Waxy" look. |
| **0.55 - 0.65** | **Equilibrium.** | **Similar Sharpness.** Replaces jagged pixels with painted strokes. "Clean" look. |
| **0.70 - 0.85** | **Refinement.** | **Sharper than input.** Adds *new* texture (pores, grain) that is sharper than the original pixels. |
| **0.90+** | **Hyper-Realism.** | **Crunchy.** Contrast and texture are exaggerated to the breaking point. |

**Final Verdict:**
If you use the **ControlNet 1.0 / End 1.0** strategy, you **MUST** push Denoise high (**0.65 - 0.80**). Using low denoise (0.4) acts merely as an expensive Gaussian Blur filter.
